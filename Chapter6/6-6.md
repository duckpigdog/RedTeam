### Windows 注册表权限维持

Windows 注册表中的 `Run` 和 `RunOnce` 键是 Windows 系统自动启动程序的重要位置

1. **`HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`**：
   - **作用**：这个键下的所有程序都会在**当前用户**每次登录时自动执行
   - **特点**：每次登录都执行，非常适合需要**持续性**和**长期控制**的后门程序。攻击者可以利用它来确保即使系统重启，后门程序也能自动启动
2. **`HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce`**：
   - **作用**：这个键下的所有程序只会在**当前用户**登录时**执行一次**，然后系统会从注册表中删除该项
   - **特点**：一次性执行，非常适合需要在系统重启后执行一次性任务的场景，例如下载并执行一个更复杂的后门程序，或者清理痕迹

以下是在当前用户登录下生效，适用于未提权，只运行一次

```cmd
reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce" /v
aa /t REG_SZ /d "C:\Users\Administrator\Downloads\b.exe"
```

目前只有一个连接

![](https://pic1.imgdb.cn/item/68d47f6cc5157e1a882d45e3.png)

执行命令

![](https://pic1.imgdb.cn/item/68d47f97c5157e1a882d45eb.png)

重新启动后上线

![](https://pic1.imgdb.cn/item/68d47feec5157e1a882d45f3.png)

另一个则是永久

```cmd
reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run" /v
aa /t REG_SZ /d "C:\Users\Administrator\Downloads\b.exe"
```

