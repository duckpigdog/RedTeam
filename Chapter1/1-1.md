### Windows 服务器信息收集

**查询版本信息**

```cmd
ver
```

`ver`：Windows 自带的一个命令，**用来显示操作系统的版本信息**

![](https://pic1.imgdb.cn/item/68c8ed5bc5157e1a8809e014.png)

**Microsoft Windows**：表明这是 Windows 操作系统

**版本 10.0.26100.4652**：这是系统的版本号，拆解如下：

- `10.0` → 主版本号，说明系统基于 Windows 10 内核（Windows 11 依然是 NT 10.0 内核）
- `26100` → 构建号（Build Number），通常代表具体的 Windows 版本或更新分支
- `4652` → 修订号（Revision），通常对应累积更新补丁

**查询架构信息**

```
wmic os get osarchitecture
```

**wmic**：Windows Management Instrumentation Command-line，简称 WMI 命令行工具，用来查询系统信息

**os**：表示操作系统类

**get osarchitecture**：查询操作系统的架构信息

![](https://pic1.imgdb.cn/item/68c8edd6c5157e1a8809e2cd.png)

`OSArchitecture` → 字段名称

`64-bit` → 操作系统是 **64 位版本**

**查询服务状态**

```
sc query state=all
```

**sc**：Service Control 的缩写，用来与 Windows 服务控制管理器（SCM）交互

**query**：表示查询服务信息

**state=all**：参数，表示列出**所有服务**，包括：

- `active` → 正在运行的服务
- `inactive` → 已安装但未运行的服务
- `all` → 上面两者都显示

![](https://pic1.imgdb.cn/item/68c92194c5157e1a880b5c47.png)

**字段解析**

- **SERVICE_NAME** → 服务的系统内部名称（比如 `wuauserv` = Windows Update）
- **TYPE** → 服务类型：
  - `10` → WIN32_OWN_PROCESS（独立进程）
  - `20` → WIN32_SHARE_PROCESS（共享进程）
- **STATE** → 服务的状态：
  - `1` = STOPPED（已停止）
  - `2` = START_PENDING（正在启动）
  - `3` = STOP_PENDING（正在停止）
  - `4` = RUNNING（正在运行）
  - `5` = CONTINUE_PENDING（继续中）
  - `6` = PAUSE_PENDING（暂停中）
  - `7` = PAUSED（已暂停）
- **WIN32_EXIT_CODE** → Windows API 返回的错误码（0 表示正常）
- **SERVICE_EXIT_CODE** → 服务自身退出码（0 表示正常）
- **CHECKPOINT** → 长操作时用于进度标记（一般为 0）
- **WAIT_HINT** → 长操作预计需要的时间（一般为 0）

**查看服务信息**

```
wmic service list brief
```

**wmic** → Windows Management Instrumentation Command-line 工具

**service** → 目标是服务对象（相当于查询系统中的所有服务）

**list brief** → 以简要模式显示（brief = 简化输出，只显示几个关键字段）

![](https://pic1.imgdb.cn/item/68c92472c5157e1a880b8c90.png)

执行后会看到类似这样的表格：

**ExitCode**

- 服务的退出代码
- `0` → 正常退出，没有错误
- `1077` → 特殊状态码，表示服务没有运行过（即从未启动）

**Name**

- 服务的显示名称（比如 `acunetix`、`Acunetix Database`、`ALG`）

**ProcessId**

- 服务对应的进程 ID
- `7784` 和 `7808` → 对应运行中的 Acunetix 主程序和数据库进程
- `0` → 没有运行（因为 ALG 服务已停止）

**StartMode**

- 服务的启动方式：
  - `Auto` → 开机自动启动
  - `Manual` → 手动启动（需要时才启动）

**State**

- 当前运行状态：
  - `Running` → 正在运行
  - `Stopped` → 已停止

**Status**

- 服务的整体健康状态，一般是 `OK`，表示没有检测到错误

**PowerShell 查询所有服务详细属性**

```powershell
Get-WmiObject win32_service | select Name,PathName
```

**Get-WmiObject win32_service**

- PowerShell 命令，用来查询 WMI（Windows Management Instrumentation）中 `win32_service` 类的信息
- `win32_service` 类包含系统里 **所有服务** 的详细属性（比如服务名、状态、可执行文件路径等）

**|** （管道符）

- 把前一个命令的输出传递给下一个命令

**select Name,PathName**

- 只选择并显示服务对象中的 `Name` 和 `PathName` 两个字段

![](https://pic1.imgdb.cn/item/68ca1303c5157e1a880f5fb7.png)

**查看正在运行的进程**

```
tasklist
```

**映像名称 (Image Name)**

- 可执行文件名，例如 `chrome.exe`、`notepad.exe`

**PID (Process ID)**

- 进程 ID，用于唯一标识进程（在调试、结束进程时常用）

**会话名 (Session Name)**

- 进程所属的会话：
  - `Services` → 系统服务进程
  - `Console` → 用户交互式会话

**会话# (Session #)**

- 会话编号，通常 `0` 表示系统服务会话，`1` 表示第一个登录用户

**内存使用 (Mem Usage)**

- 进程当前占用的物理内存大小

![](https://pic1.imgdb.cn/item/68ca1461c5157e1a880f6f64.png)

**查看正在运行的进程所承载的 Windows 服务**

```cmd
tasklist /svc
```

**/svc** → 额外显示每个进程所承载的 **Windows 服务**

**映像名称 (Image Name)**

- 可执行文件名称，例如 `svchost.exe`、`services.exe`

**PID (Process ID)**

- 进程 ID

**服务 (Services)**

- 当前进程所托管的服务
- 如果进程和服务没有直接关系（比如普通应用），会显示 `N/A`
- 典型例子：
  - `svchost.exe` → 通常会托管多个系统服务，如 `Dhcp`、`Dnscache`、`EventLog` 等
  - `lsass.exe` → 托管身份验证相关服务，如 `SamSs`、`KeyIso`

![](https://pic1.imgdb.cn/item/68ca15fbc5157e1a880f8e91.png)

**快速查看进程名、PID、优先级、线程数和内存使用情况**

```cmd
wmic process list brief
```

**wmic** → Windows Management Instrumentation Command-line 工具

**process** → 查询对象是“进程”

**list brief** → 使用简化模式显示，输出关键字段

**Handle**

- 进程句柄值，通常是进程的内核对象标识符

**Name**

- 进程名称（可执行文件名，例如 `notepad.exe`、`chrome.exe`）

**Priority**

- 进程优先级：
  - 通常 8 → 正常优先级 (Normal)
  - 13 → 高优先级 (High)
  - 4 → 空闲优先级 (Idle)

**ProcessId (PID)**

- 进程 ID，用来唯一标识进程

**ThreadCount**

- 当前进程中运行的线程数

**WorkingSetSize**

- 进程正在使用的物理内存大小（以字节为单位）

![](https://pic1.imgdb.cn/item/68ca1717c5157e1a880f9e17.png)

**PowerShell 中查询进程信息**

```
ps
```

**Id** → 进程 PID

**ProcessName** → 进程名

**CPU(s)** → 占用 CPU 时间

**WS(K)** → 工作集（常驻内存）

**PM(K)** → 占用的私有内存

**SI** → 会话 ID

![](https://pic1.imgdb.cn/item/68ca189cc5157e1a880fa53a.png)

**查看驱动程序**

```cmd
driverquery
```

**模块名 (Module Name)**

- 驱动程序的内部名称，例如 `ACPI`、`afd`

**显示名称 (Display Name)**

- 驱动的友好名称，例如 *Microsoft ACPI 驱动程序*

**驱动类型 (Driver Type)**

- 驱动的类别，例如：
  - `内核驱动 (Kernel Driver)` → 内核级驱动（大多数硬件驱动）
  - `文件系统驱动 (File System Driver)` → 文件系统相关驱动
  - `已加载的用户模式驱动 (Win32 Own Process)` → 独立运行的用户态服务

**链接日期 (Link Date)**

- 驱动的编译/链接时间，通常对应驱动版本或系统更新日期

![](https://pic1.imgdb.cn/item/68ca1a7ac5157e1a880fbb16.png)

**查看磁盘信息**

```cmd
wmic logicaldisk get Caption,Description,ProviderName
```

**wmic** → Windows Management Instrumentation Command-line 工具，用于查询系统硬件、软件和配置

**logicaldisk** → 查询对象是 **逻辑磁盘**，包括本地磁盘、光驱、网络驱动器等

**get Caption,Description,ProviderName** → 只显示三个属性：

- `Caption` → 逻辑盘符（如 C:、D:、Z:）
- `Description` → 逻辑磁盘类型描述（如 “本地磁盘”、“CD-ROM”、“网络驱动器”）
- `ProviderName` → 如果是网络驱动器，显示网络共享路径；本地磁盘或 CD-ROM 一般为空

![](https://pic1.imgdb.cn/item/68ca1ad9c5157e1a880fbbb4.png)

**PowerShell 查看补丁信息**

```powershell
Get-Hotfix
```

**Source** → 补丁来源主机名（本机名 `DESKTOP-JRG4U86`）

**Description** → 补丁类型或类别

- `Update` → 一般更新
- `Security Update` → 安全更新

**HotFixID** → 补丁编号

**InstalledBy** → 安装该补丁的用户

- `NT AUTHORITY\SYSTEM` → 系统自动安装
- `DESKTOP-JRG4U86\ydd33` → 用户手动安装

**InstalledOn** → 安装日期和时间（PowerShell 显示时间部分，WMIC 只显示日期）

![](https://pic1.imgdb.cn/item/68ca1cecc5157e1a880fc37f.png)

**查询系统信息**

```cmd
systeminfo
```

![](https://pic1.imgdb.cn/item/68ca1db9c5157e1a880fc661.png)

**PowerShell 查询注册表**

```powershell
Get-ChildItem -path Registry::HKEY_LOCAL_MACHINE\SOFTWARE | ft Name
```

**Get-ChildItem**

- PowerShell 中获取指定路径下的 **子项/文件夹列表**
- 在注册表里，它可以用来列出某个注册表键下的子键

**-Path Registry::HKEY_LOCAL_MACHINE\SOFTWARE**

- 指定路径为注册表的 **HKEY_LOCAL_MACHINE\SOFTWARE** 键
- `Registry::` 是 PowerShell 注册表提供的 **驱动器前缀**，告诉 PowerShell 操作注册表而不是文件系统

**| ft Name**

- `|` 管道符，把前面命令的输出传给下一个命令
- `ft` = `Format-Table`，将结果格式化为表格，只显示 **Name** 列

![](https://pic1.imgdb.cn/item/68ca1e8ac5157e1a880fce66.png)

**PowerShell 查询安装文件夹**

```powershell
Get-ChildItem 'C:\Program Files','C:\Program Files (x86)' | ft Parent,Name,LastWriteTime
```

**Parent** → 表示该文件夹属于哪个程序目录

**Name** → 软件或文件夹名称

**LastWriteTime** → 文件夹最后写入时间，一般接近软件安装或更新日期

![](https://pic1.imgdb.cn/item/68ca1f99c5157e1a880fd799.png)

**PowerShell 列出系统中所有 MSI 安装的软件**

```powershell
Get-WmiObject -Class Win32_Product
```

**Get-WmiObject**

- PowerShell 中用于访问 **WMI（Windows Management Instrumentation）对象**的命令
- WMI 是 Windows 系统提供的统一管理接口，可以查询硬件、软件、操作系统、进程、服务等信息。

**-Class Win32_Product**

- 指定 WMI 类为 **Win32_Product**
- `Win32_Product` 表示 **通过 Windows Installer（MSI）安装的软件**
- 只有使用 MSI 安装的软件才会出现在这个类中，便携版或普通 EXE 安装的软件不会被列出

![](https://pic1.imgdb.cn/item/68ca211dc5157e1a880fdddb.png)

**列出系统中所有 MSI 安装的软件**

```cmd
wmic product get name,version
```

**wmic**

- Windows Management Instrumentation Command-line（WMIC）工具
- 用于从命令行访问 **Windows Management Instrumentation (WMI)** 对象
- 可以查询硬件、软件、操作系统信息，也能管理系统资源

**product**

- 查询对象为 **Win32_Product** 类
- 该类表示通过 **Windows Installer（MSI）** 安装的软件

**get name,version**

- 指定只输出 **软件名称**（Name）和 **版本号**（Version）

![](https://pic1.imgdb.cn/item/68ca234cc5157e1a880fe94a.png)

**查看计划任务**

```
Schtasks /query /fo LIST /v
```

- **Schtasks**
  - Windows 内置命令，用于 **查看、创建、删除或管理计划任务**
  - 类似 GUI 的“任务计划程序”，但通过命令行操作
- **/query**
  - 查询系统中现有的计划任务
- **/fo LIST**
  - 指定输出格式为 **LIST（列表形式）**
  - 另一种常用格式：`TABLE`（表格）、`CSV`（逗号分隔，用于导出）
- **/v**
  - 表示 **Verbose（详细模式）**，输出所有任务的完整信息，包括：
    - 任务名称
    - 触发器（Trigger）
    - 下一次运行时间
    - 上次运行结果
    - 任务状态
    - 运行的命令或脚本路径

![](https://pic1.imgdb.cn/item/68ca23edc5157e1a880feb1e.png)

**查看开机自启动信息**

```
wmic startup get caption,command,location
```

**wmic**

- Windows Management Instrumentation Command-line 工具
- 用于访问和管理 WMI（Windows Management Instrumentation）对象

**startup**

- 查询对象为 **Win32_StartupCommand** 类
- 该类表示系统开机时自动启动的程序或脚本

**get caption,command,location**

- 指定输出三个字段：
  - **Caption** → 启动项名称（通常是可读名称或描述）
  - **Command** → 启动程序或脚本的完整路径及参数
  - **Location** → 启动项位置（注册表路径或启动文件夹路径）

![](https://pic1.imgdb.cn/item/68ca24d2c5157e1a880fecc4.png)

**查看环境变量**

```
set
```

![](https://pic1.imgdb.cn/item/68ca2500c5157e1a880fed27.png)